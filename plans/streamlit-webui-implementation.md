---
task_id: streamlit-webui-implementation
type: FEAT
complexity: S
current_phase: COMPLETED
completed_phases: [P0, P0.B, P0.C, P2.G, P2.R, P2.A, I.G, I.R, PC]
branch: feature/streamlit-webui

next_action: NONE
next_action_prompt: ""

blocked: false
blocked_reason: ""

created_at: 2026-01-11
updated_at: 2026-01-11
completed_at: 2026-01-11
---

# Streamlit WebUI å®ç°è®¡åˆ’

> åŸºäºè°ƒç ”æŠ¥å‘Š `plans/streamlit-webui-research.md` çš„å®ç°ä»»åŠ¡

## é—®é¢˜å®šä¹‰

**ç±»å‹**: FEAT-S (æ ‡å‡†åŠŸèƒ½å¼€å‘)

**èƒŒæ™¯**: è°ƒç ”æŠ¥å‘Šå·²ç¡®è®¤ Streamlit æ˜¯æœ€ä½³æŠ€æœ¯é€‰å‹ã€‚ç°åœ¨éœ€è¦å®ç° WebUIï¼Œæä¾›å‚æ•°é…ç½®ã€è¿›åº¦ç›‘æ§å’Œä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼Œæå‡å·¥å…·æ˜“ç”¨æ€§ã€‚

**èŒƒå›´**:

### åšä»€ä¹ˆ
1. åˆ›å»º `webui/` ç›®å½•ï¼Œæ­å»º Streamlit å¤šé¡µåº”ç”¨éª¨æ¶
2. å®ç°ç›‘æ§ä»ªè¡¨ç›˜é¡µï¼ˆå¤ç”¨ DuckDB è§†å›¾å±•ç¤ºè¿›åº¦ï¼‰
3. å®ç°é…ç½®ç®¡ç†é¡µï¼ˆè¯»å†™ `config.yaml`ï¼‰
4. å®ç°ä»»åŠ¡ç®¡ç†é¡µï¼ˆåå°è¿›ç¨‹å¯åœã€æ—¥å¿—æŸ¥çœ‹ï¼‰
5. æ·»åŠ åŸºç¡€æµ‹è¯•

### ä¸åšä»€ä¹ˆ
- ä¸å®ç°ç”¨æˆ·è®¤è¯ï¼ˆP3 ä¼˜å…ˆçº§ï¼Œæœ¬æ¬¡è¿­ä»£ä¸åšï¼‰
- ä¸å®ç°å¤æ‚çš„ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼ˆä½¿ç”¨ç®€å•çš„ subprocessï¼‰
- ä¸åš Docker åŒ–éƒ¨ç½²ï¼ˆåç»­è¿­ä»£ï¼‰

**å®Œæˆæ ‡å‡†**:
1. `streamlit run webui/app.py` å¯æ­£å¸¸å¯åŠ¨
2. ç›‘æ§ä»ªè¡¨ç›˜é¡µå¯å±•ç¤º `reports_progress` ç­‰è§†å›¾æ•°æ®
3. é…ç½®ç®¡ç†é¡µå¯è¯»å–ã€ç¼–è¾‘ã€ä¿å­˜ `config.yaml`
4. ä»»åŠ¡ç®¡ç†é¡µå¯å¯åŠ¨/åœæ­¢çˆ¬è™«ã€ä¸‹è½½ã€æå–ä»»åŠ¡
5. åŸºç¡€æµ‹è¯•é€šè¿‡

---

## è®¾è®¡è§„æ ¼ä¹¦ (P2.G + P2.R)

> Gemini ç”Ÿæˆåˆç¨¿ï¼ŒClaude å®¡æ ¸å®Œå–„

### 1. æ–‡ä»¶ç»“æ„

```
webui/
â”œâ”€â”€ app.py                      # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ .streamlit/
â”‚   â””â”€â”€ config.toml             # Streamlit é…ç½®
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ 1_ğŸ“Š_ç›‘æ§ä»ªè¡¨ç›˜.py       # è¿›åº¦ç›‘æ§é¡µ
â”‚   â”œâ”€â”€ 2_âš™ï¸_é…ç½®ç®¡ç†.py         # é…ç½®ç¼–è¾‘é¡µ
â”‚   â””â”€â”€ 3_ğŸš€_ä»»åŠ¡ç®¡ç†.py         # ä»»åŠ¡æ§åˆ¶é¡µ
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ db_utils.py             # DuckDB æŸ¥è¯¢å°è£…
â”‚   â”œâ”€â”€ config_editor.py        # config.yaml è¯»å†™
â”‚   â””â”€â”€ task_runner.py          # åå°ä»»åŠ¡ç®¡ç†
â””â”€â”€ requirements.txt            # ä¾èµ–
```

### 2. é¡µé¢è¯¦ç»†è®¾è®¡

#### 2.1 ç›‘æ§ä»ªè¡¨ç›˜é¡µ (`1_ğŸ“Š_ç›‘æ§ä»ªè¡¨ç›˜.py`)

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ç›‘æ§ä»ªè¡¨ç›˜                            [ğŸ”„ åˆ·æ–°æ•°æ®] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ å¾…ä¸‹è½½  â”‚  â”‚ å¾…è½¬æ¢  â”‚  â”‚ å¾…å®¡æ ¸  â”‚  â”‚ å·²å®Œæˆ  â”‚     â”‚
â”‚ â”‚   127   â”‚  â”‚   45    â”‚  â”‚   12    â”‚  â”‚  1,234  â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¹´åº¦å¤„ç†è¿›åº¦                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ year | total | downloaded | converted | extracted  â”‚ â”‚
â”‚ â”‚ 2023 | 5000  | 4500       | 4200      | 4000       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å¾…ä¸‹è½½é˜Ÿåˆ—] [å¾…è½¬æ¢é˜Ÿåˆ—] [å¾…å®¡æ ¸ MDA]                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ stock_code | short_name | year | url               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶**:
- `st.metric`: å…³é”®æŒ‡æ ‡ï¼ˆå¾…ä¸‹è½½ã€å¾…è½¬æ¢ã€å¾…å®¡æ ¸ã€å·²å®Œæˆï¼‰
- `st.dataframe`: å¹´åº¦è¿›åº¦è¡¨ã€å¾…å¤„ç†é˜Ÿåˆ—
- `st.tabs`: åˆ‡æ¢ä¸åŒé˜Ÿåˆ—è§†å›¾
- `st.button`: åˆ·æ–°æ•°æ®

#### 2.2 é…ç½®ç®¡ç†é¡µ (`2_âš™ï¸_é…ç½®ç®¡ç†.py`)

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ é…ç½®ç®¡ç†                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ çˆ¬è™«é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ç›®æ ‡å¹´ä»½: [2023] [2022] [2021]                     â”‚  â”‚
â”‚ â”‚ æ¿å—: [âœ“ æ²ªå¸‚ä¸»æ¿] [âœ“ æ·±å¸‚ä¸»æ¿] [ ] åˆ›ä¸šæ¿        â”‚  â”‚
â”‚ â”‚ æ’é™¤å…³é”®è¯: [æ‘˜è¦] [åŠå¹´æŠ¥] [å­£æŠ¥]                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”Œâ”€ ä¸‹è½½é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ å¹¶å‘è¿›ç¨‹æ•°: [4]                                    â”‚  â”‚
â”‚ â”‚ [âœ“] ä¸‹è½½ååˆ é™¤ PDF  [ ] è·³è¿‡å·²å­˜åœ¨                 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”Œâ”€ MDA æå–é…ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ å·¥ä½œè¿›ç¨‹æ•°: [4]                                    â”‚  â”‚
â”‚ â”‚ [âœ“] å¢é‡æ¨¡å¼                                       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        [ğŸ’¾ ä¿å­˜é…ç½®]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶**:
- `st.form`: åŒ…è£¹æ‰€æœ‰é…ç½®é¡¹ï¼Œé¿å…é¢‘ç¹åˆ·æ–°
- `st.multiselect`: å¹´ä»½ã€æ¿å—é€‰æ‹©
- `st.number_input`: å¹¶å‘æ•°
- `st.checkbox`: å¸ƒå°”é€‰é¡¹
- `st.text_area`: æ’é™¤å…³é”®è¯ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰

#### 2.3 ä»»åŠ¡ç®¡ç†é¡µ (`3_ğŸš€_ä»»åŠ¡ç®¡ç†.py`)

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸš€ ä»»åŠ¡ç®¡ç†                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ çˆ¬å–é“¾æ¥ â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€ ä¸‹è½½è½¬æ¢ â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€ MDA â”€â”  â”‚
â”‚ â”‚ çŠ¶æ€: â— å·²åœæ­¢    â”‚ â”‚ çŠ¶æ€: â— è¿è¡Œä¸­    â”‚ â”‚ â— åœæ­¢â”‚  â”‚
â”‚ â”‚ [â–¶ å¯åŠ¨] [â–  åœæ­¢] â”‚ â”‚ [â–¶ å¯åŠ¨] [â–  åœæ­¢] â”‚ â”‚ [â–¶][â– ]â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®æ—¶æ—¥å¿—                                   [è‡ªåŠ¨åˆ·æ–° âœ“] â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [2026-01-11 10:30:15] å¼€å§‹ä¸‹è½½ 600519_è´µå·èŒ…å°...  â”‚ â”‚
â”‚ â”‚ [2026-01-11 10:30:16] ä¸‹è½½å®Œæˆ                     â”‚ â”‚
â”‚ â”‚ [2026-01-11 10:30:17] å¼€å§‹è½¬æ¢...                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç»„ä»¶**:
- `st.columns`: å¹¶æ’æ˜¾ç¤ºä»»åŠ¡æ§åˆ¶åŒº
- `st.button`: å¯åŠ¨/åœæ­¢æŒ‰é’®
- `st.status`: ä»»åŠ¡çŠ¶æ€æŒ‡ç¤º
- `st.code`: æ—¥å¿—æ˜¾ç¤º
- `st.checkbox`: è‡ªåŠ¨åˆ·æ–°å¼€å…³

### 3. æ ¸å¿ƒç»„ä»¶æ¥å£

#### 3.1 `components/db_utils.py`

```python
from __future__ import annotations
import streamlit as st
import duckdb
import pandas as pd
from pathlib import Path

DEFAULT_DB_PATH = Path("data/annual_reports.duckdb")

@st.cache_resource
def get_connection(db_path: Path = DEFAULT_DB_PATH) -> duckdb.DuckDBPyConnection:
    """è·å– DuckDB åªè¯»è¿æ¥ï¼ˆç¼“å­˜ï¼‰"""
    return duckdb.connect(str(db_path), read_only=True)

@st.cache_data(ttl=60)
def get_reports_progress(_conn: duckdb.DuckDBPyConnection) -> pd.DataFrame:
    """æŸ¥è¯¢å¹´åº¦å¤„ç†è¿›åº¦"""
    return _conn.execute("SELECT * FROM reports_progress").df()

@st.cache_data(ttl=60)
def get_pending_downloads(_conn: duckdb.DuckDBPyConnection) -> pd.DataFrame:
    """æŸ¥è¯¢å¾…ä¸‹è½½é˜Ÿåˆ—"""
    return _conn.execute("SELECT * FROM pending_downloads LIMIT 100").df()

@st.cache_data(ttl=60)
def get_pending_converts(_conn: duckdb.DuckDBPyConnection) -> pd.DataFrame:
    """æŸ¥è¯¢å¾…è½¬æ¢é˜Ÿåˆ—"""
    return _conn.execute("SELECT * FROM pending_converts LIMIT 100").df()

@st.cache_data(ttl=60)
def get_mda_needs_review(_conn: duckdb.DuckDBPyConnection) -> pd.DataFrame:
    """æŸ¥è¯¢å¾…å®¡æ ¸ MDA"""
    return _conn.execute("SELECT * FROM mda_needs_review LIMIT 100").df()

def get_counts(_conn: duckdb.DuckDBPyConnection) -> dict[str, int]:
    """è·å–å„é˜Ÿåˆ—è®¡æ•°"""
    return {
        "pending_downloads": _conn.execute("SELECT COUNT(*) FROM pending_downloads").fetchone()[0],
        "pending_converts": _conn.execute("SELECT COUNT(*) FROM pending_converts").fetchone()[0],
        "mda_needs_review": _conn.execute("SELECT COUNT(*) FROM mda_needs_review").fetchone()[0],
        "total_extracted": _conn.execute(
            "SELECT COUNT(*) FROM reports WHERE extract_status = 'success'"
        ).fetchone()[0],
    }
```

#### 3.2 `components/config_editor.py`

```python
from __future__ import annotations
from pathlib import Path
import yaml

DEFAULT_CONFIG_PATH = Path("config.yaml")

def load_config(config_path: Path = DEFAULT_CONFIG_PATH) -> dict:
    """è¯»å– config.yaml"""
    if not config_path.exists():
        return {}
    with open(config_path, encoding="utf-8") as f:
        return yaml.safe_load(f) or {}

def save_config(config_data: dict, config_path: Path = DEFAULT_CONFIG_PATH) -> None:
    """ä¿å­˜ config.yaml"""
    with open(config_path, "w", encoding="utf-8") as f:
        yaml.dump(config_data, f, allow_unicode=True, default_flow_style=False)
```

#### 3.3 `components/task_runner.py`

```python
from __future__ import annotations
import subprocess
import signal
from pathlib import Path
from dataclasses import dataclass
from typing import Literal

TaskName = Literal["crawler", "converter", "extractor"]

TASK_SCRIPTS = {
    "crawler": "1.report_link_crawler.py",
    "converter": "2.pdf_batch_converter.py",
    "extractor": "mda_extractor.py",
}

LOG_DIR = Path("logs/webui")

@dataclass
class TaskState:
    process: subprocess.Popen | None = None
    log_file: Path | None = None

def start_task(task_name: TaskName, extra_args: list[str] | None = None) -> TaskState:
    """å¯åŠ¨åå°ä»»åŠ¡"""
    LOG_DIR.mkdir(parents=True, exist_ok=True)
    log_file = LOG_DIR / f"{task_name}.log"

    script = TASK_SCRIPTS[task_name]
    cmd = ["python", script, "--use-config"]
    if extra_args:
        cmd.extend(extra_args)

    with open(log_file, "w", encoding="utf-8") as f:
        process = subprocess.Popen(
            cmd,
            stdout=f,
            stderr=subprocess.STDOUT,
            cwd=Path.cwd(),
        )

    return TaskState(process=process, log_file=log_file)

def stop_task(state: TaskState) -> None:
    """åœæ­¢ä»»åŠ¡"""
    if state.process and state.process.poll() is None:
        state.process.terminate()
        try:
            state.process.wait(timeout=5)
        except subprocess.TimeoutExpired:
            state.process.kill()

def get_task_status(state: TaskState) -> str:
    """è·å–ä»»åŠ¡çŠ¶æ€"""
    if state.process is None:
        return "stopped"
    exit_code = state.process.poll()
    if exit_code is None:
        return "running"
    return "completed" if exit_code == 0 else "error"

def read_log(state: TaskState, tail_lines: int = 50) -> str:
    """è¯»å–æ—¥å¿—å°¾éƒ¨"""
    if state.log_file is None or not state.log_file.exists():
        return ""
    lines = state.log_file.read_text(encoding="utf-8", errors="replace").splitlines()
    return "\n".join(lines[-tail_lines:])
```

### 4. çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

ä½¿ç”¨ `st.session_state` ç®¡ç†ä»»åŠ¡è¿›ç¨‹çŠ¶æ€ï¼š

```python
# åœ¨ 3_ğŸš€_ä»»åŠ¡ç®¡ç†.py å¼€å¤´åˆå§‹åŒ–
if "task_states" not in st.session_state:
    st.session_state.task_states = {
        "crawler": TaskState(),
        "converter": TaskState(),
        "extractor": TaskState(),
    }
```

### 5. é”™è¯¯å¤„ç†

| åœºæ™¯ | å¤„ç†æ–¹å¼ |
|------|----------|
| DuckDB è¿æ¥å¤±è´¥ | `st.error("æ•°æ®åº“è¿æ¥å¤±è´¥")`ï¼Œè¿”å›ç©º DataFrame |
| config.yaml ä¸å­˜åœ¨ | `st.warning("é…ç½®æ–‡ä»¶ä¸å­˜åœ¨")`ï¼Œä½¿ç”¨é»˜è®¤å€¼ |
| ä»»åŠ¡å¯åŠ¨å¤±è´¥ | `st.error("å¯åŠ¨å¤±è´¥: {error}")`ï¼Œè®°å½•å¼‚å¸¸ |
| ä»»åŠ¡å¼‚å¸¸é€€å‡º | çŠ¶æ€æ˜¾ç¤º "é”™è¯¯"ï¼Œæç¤ºæŸ¥çœ‹æ—¥å¿— |

### 6. éªŒæ”¶æ ‡å‡†

| ID | Given | When | Then |
|----|-------|------|------|
| W1 | webui/ ç›®å½•å­˜åœ¨ | `streamlit run webui/app.py` | åº”ç”¨å¯åŠ¨ï¼Œæ˜¾ç¤ºé¦–é¡µ |
| W2 | DuckDB æœ‰ 5 æ¡å¾…ä¸‹è½½è®°å½• | è®¿é—®ç›‘æ§é¡µ | "å¾…ä¸‹è½½" æŒ‡æ ‡æ˜¾ç¤º 5 |
| W3 | config.yaml ä¸­ processes=4 | ä¿®æ”¹ä¸º 8 å¹¶ä¿å­˜ | æ–‡ä»¶æ›´æ–°ï¼Œæ˜¾ç¤ºæˆåŠŸæç¤º |
| W4 | æ‰€æœ‰ä»»åŠ¡åœæ­¢ | ç‚¹å‡»"å¯åŠ¨çˆ¬å–" | çŠ¶æ€å˜ä¸º"è¿è¡Œä¸­"ï¼Œåå°è¿›ç¨‹å¯åŠ¨ |
| W5 | çˆ¬å–ä»»åŠ¡è¿è¡Œä¸­ | ç‚¹å‡»"åœæ­¢" | çŠ¶æ€å˜ä¸º"å·²åœæ­¢"ï¼Œè¿›ç¨‹ç»ˆæ­¢ |
